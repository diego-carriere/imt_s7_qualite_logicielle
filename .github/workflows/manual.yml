name: Java Report for BankApplication

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]
  workflow_dispatch:

jobs:
  validate-and-report:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      # 1. Fail if compiled .class files are present
      - name: Check for .class files
        run: |
          CLASS_FILES=$(find . -name "*.class")
          if [ -n "$CLASS_FILES" ]; then
            echo "ERROR: Compiled .class files were found in the repository!"
            echo "$CLASS_FILES"
            exit 1
          fi
          echo "Success: No .class files found."

      # 2. Fail if no .java files exist
      - name: Check for .java files
        run: |
          JAVA_FILES=$(find . -name "*.java")
          if [ -z "$JAVA_FILES" ]; then
            echo "ERROR: No .java files found in the repository."
            exit 1
          fi
          echo "Success: Java files located."

      # 3. Generate the report
      - name: Generate java-file-report.txt
        run: |
          REPORT="java-file-report.txt"
          echo "BANK APPLICATION JAVA REPORT" > $REPORT
          echo "Generated on: $(date)" >> $REPORT
          echo "----------------------------" >> $REPORT
          
          # Count files and total lines
          FILE_COUNT=$(find . -name "*.java" | wc -l)
          TOTAL_LOC=$(find . -name "*.java" -exec cat {} + | wc -l)
          
          echo "Number of .java files: $FILE_COUNT" >> $REPORT
          echo "Total lines of code: $TOTAL_LOC" >> $REPORT
          echo "----------------------------" >> $REPORT
          echo "Per-file breakdown (Line Count - Path):" >> $REPORT
          
          # List per-file breakdown (wc -l output is "count path")
          find . -name "*.java" -exec wc -l {} + | sed '$d' >> $REPORT

      # 4. Upload the report as an artifact
      - name: Upload Report Artifact
        uses: actions/upload-artifact@v4
        with:
          name: java-file-report
          path: java-file-report.txt
